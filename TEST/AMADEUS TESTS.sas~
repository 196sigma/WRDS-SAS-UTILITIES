LIBNAME AMA "/folders/myshortcuts/WRDS2/bvd/ama_l";


PROC CONTENTS 
	DATA=AMA.FINANCIALS_L
	VARNUM
	DETAILS;
	RUN;
	
DATA ENTRYEXIT;
	SET AMA.FINANCIALS_L (KEEP=IDNR CLOSDATE);
RUN;

PROC SORT DATA=ENTRYEXIT;
	BY IDNR CLOSDATE;
RUN;

PROC PRINT DATA=ENTRYEXIT (OBS=100); RUN;

DATA ENTRY EXIT;
	SET ENTRYEXIT;
	BY IDNR;
	IF FIRST.IDNR AND NOT LAST.IDNR THEN DO;
		ENTRY = CLOSDATE;
		OUTPUT ENTRY;
	END; ELSE IF LAST.IDNR AND NOT FIRST.IDNR THEN DO;
		EXIT = CLOSDATE;
		OUTPUT EXIT;
	END;
RUN;

DATA ENTRYEXIT;
	SET ENTRYEXIT;
	BY IDNR;
	
	IF FIRST.IDNR THEN DO;
		ENTRY = 1;
	END; ELSE DO;
		ENTRY = 0;
	END;

	IF LAST.IDNR THEN DO;
		EXIT = 1;
	END; ELSE DO;
		EXIT = 0;
	END;

	OUTPUT ENTRYEXIT;

RUN;


PROC SORT DATA=ENTRYEXIT; BY CLOSDATE; RUN;
DATA ENTRYEXITBYDATE;
	SET ENTRYEXIT (KEEP = CLOSDATE ENTRY EXIT);
	BY CLOSDATE;
	
	RETAIN TOTEXIT TOTENTRY;
	
	IF FIRST.CLOSDATE THEN DO;
		TOTEXIT = 0;
		TOTENTRY = 0;
	END; ELSE DO;
		TOTEXIT + EXIT;
		TOTENTRY + ENTRY;
	END;
	
	IF LAST.CLOSDATE THEN DO;
		OUTPUT;
	END;
RUN;
	
PROC PRINT DATA=ENTRYEXITBYDATE (OBS=1000);RUN;


PROC EXPAND
	DATA = ENTRYEXITBYDATE
	OUT = ENTRYEXITBYQTR
	FROM = DAY
	TO = QTR;
	
	ID CLOSDATE;
	
	CONVERT TOTEXIT-TOTENTRY / TRANSFORMOUT=(SUM);
RUN;


	

;
